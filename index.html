<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Capsule Builder - 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #2a2a2a;
            color: white;
            overflow: hidden;
        }
        
        .container {
            display: grid;
            grid-template-columns: 250px 1fr 250px;
            height: 100vh;
        }
        
        .sidebar {
            background: #1a1a1a;
            padding: 20px;
            overflow-y: auto;
        }
        
        .sidebar h3 {
            margin-bottom: 20px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
        }
        
        .parts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .part-item {
            background: #333;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .part-item:hover {
            border-color: #00ff88;
            transform: scale(1.05);
        }
        
        .part-item.selected {
            border-color: #00ff88;
            background: #2a4a3a;
        }
        
        .part-item svg {
            width: 80%;
            height: 80%;
            fill: white;
        }
        
        .canvas-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        #canvas-3d {
            width: 600px;
            height: 600px;
            border-radius: 20px;
        }
        
        .controls {
            position: absolute;
            bottom: 40px;
            display: flex;
            gap: 15px;
        }
        
        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #00dd77;
            transform: translateY(-2px);
        }
        
        button.secondary {
            background: #333;
            color: white;
        }
        
        button.secondary:hover {
            background: #444;
        }
        
        .info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .selected-info {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid #00ff88;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            display: none;
            min-width: 180px;
        }
        
        .selected-info.active {
            display: block;
        }
        
        .selected-info h4 {
            color: #00ff88;
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .slider-container {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .slider-label {
            color: #00ff88;
            font-size: 11px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }
        
        .slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            border: none;
        }
        
        .color-picker {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
        }
        
        .color-picker h4 {
            font-size: 12px;
            margin-bottom: 10px;
            color: #888;
            text-transform: uppercase;
        }
        
        .color-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .color-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .color-btn:hover {
            transform: scale(1.1);
        }
        
        .color-btn.active {
            border-color: white;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00ff88;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h3>Basic Shapes</h3>
            <div class="parts-grid" id="parts-left"></div>
        </div>
        
        <div class="canvas-area">
            <div class="color-picker">
                <h4>Color</h4>
                <div class="color-options">
                    <button class="color-btn active" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" data-color="0"></button>
                    <button class="color-btn" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" data-color="1"></button>
                    <button class="color-btn" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" data-color="2"></button>
                    <button class="color-btn" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" data-color="3"></button>
                    <button class="color-btn" style="background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);" data-color="4"></button>
                    <button class="color-btn" style="background: linear-gradient(135deg, #8e2de2 0%, #4a00e0 100%);" data-color="5"></button>
                    <button class="color-btn" style="background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);" data-color="6"></button>
                    <button class="color-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" data-color="7"></button>
                </div>
            </div>
            
            <div class="info">
                <div>Parts: <span id="part-count">0</span></div>
                <div style="font-size: 12px; margin-top: 5px; color: #888;">Drag to rotate</div>
            </div>
            
            <div class="selected-info" id="selected-info">
                <h4>Edit Part</h4>
                <div style="color: #ccc; margin-bottom: 4px;">Drag to move</div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Scale</span>
                        <span id="scale-value">100%</span>
                    </div>
                    <input type="range" min="30" max="300" value="100" class="slider" id="scale-slider">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Rotation X</span>
                        <span id="rotation-x-value">0°</span>
                    </div>
                    <input type="range" min="0" max="360" value="0" class="slider" id="rotation-x-slider">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Rotation Y</span>
                        <span id="rotation-y-value">0°</span>
                    </div>
                    <input type="range" min="0" max="360" value="0" class="slider" id="rotation-y-slider">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Rotation Z</span>
                        <span id="rotation-z-value">0°</span>
                    </div>
                    <input type="range" min="0" max="360" value="0" class="slider" id="rotation-z-slider">
                </div>
                
                <button id="delete-btn" style="width: 100%; margin-top: 12px; padding: 8px; background: #ff4444; font-size: 12px;">Delete</button>
            </div>
            <canvas id="canvas-3d"></canvas>
            
            <div class="controls">
                <button class="secondary" id="reset-btn">Reset</button>
                <button id="save-btn">Create Time Capsule</button>
            </div>
        </div>
        
        <div class="sidebar">
            <h3>Custom Parts</h3>
            <div class="parts-grid" id="parts-right"></div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js"
        }
    }
    </script>
    <script type="module">
        import * as THREE from 'three';
        
        // SVG data
        const allSvgPaths = [
            { id: 1, viewBox: "0 0 120.29 776.67", path: "M58.61,6.74c8.05,7.09,17.3,23.07,20.5,40.22,1.99,9.63,1.77,22.69-2.45,28.51-3.77,5.36-8,5.1-13.41,8.21-10.95,5.19-21.63,26.6-27.59,47.98-3.49,11.94-6.69,23.89-8.65,40.49-3.35,26.91-1.32,60.97,5.77,84.58,17.15,58.2,48.07,53.43,67.98,90.05,8.87,16.21,17.65,44.78,12.44,72.5-4.75,29.19-22.12,41.67-21.96,75.47.04,20.01,5.73,38.68,10.19,55.34,7.97,28.28,14.31,60.57,17.25,93.73,3.32,33.16,1.83,66.22-7.44,92.11-7.61,22.29-18.57,40.78-31.03,40.76-21.79.54-41-45.05-43-95.42-2.5-40.5,2.74-81.86.79-122.49-2.27-49.21-17.85-88.33-22.25-136.52-2.36-22.07-2.58-45.03-1.33-67.54,2.17-34.47,3.97-65.2-2.44-98.14C1.24,202.71-6.87,168.93,8.54,113.28c3.73-13.56,6.68-27.87,7.39-44.13,1.08-19.91,1.74-43.81,9.22-56.66C34.02-3.23,48.02-2.82,58.41,6.56l.19.17Z" },
            { id: 2, viewBox: "0 0 192.44 631.71", path: "M118.87,12.14c13.81-16.31,33.01-3.54,41.48,20.21,20.36,57.22-12.86,145.95-12.96,213.31-.25,11.48.21,22.89,1.52,34,3.5,29.97,12.72,55.83,21.46,81.8,14.67,41.86,29.34,91.95,18.08,142.1-7.76,37.47-30.12,55.37-43.14,16.41-4.18-13-5.59-28.76-5.59-43.76,1.09-51.13,9.31-90.7-14.19-130.15-15.06-26.51-39.45-32.76-57.36-17.78-19.68,15.12-33.87,49.35-30.58,84.81,1.62,18.85,8.62,36.38,16.83,48.88,8.28,13.15,18.14,23.95,23.15,42.33,6.32,23.74,5.66,55.6,16.43,76.52,3.01,6.39,6.92,11.72,10.62,16.48,3.62,5.31,9.44,10.61,9.37,18.44-1.09,9.93-10.07,13.14-16.82,15.04-18.87,4.19-39.71-5.99-55.83-24.22C-2.82,557.45-8.7,450.45,10.06,366.55c6.16-29.62,15.97-57.13,27.51-80.37,5.46-11.29,11.4-22.48,16.32-33.72,16.27-34.42,17.92-78.71,6.46-118.93-10.71-39.89-35.18-56.79-41.82-95.88-2.06-13.13.07-29.24,6.97-35.58,18.14-12.23,24.16,32.83,37.62,50,5.28,7.38,11.98,11.57,18.63,10.3,17.46-2.85,23.97-34.82,36.97-50.07l.15-.17Z" },
            { id: 3, viewBox: "0 0 199.85 661.11", path: "M86.86,169.39c24.94,61.78,107.84,157.99,95.51,246.42-9.31,54.67-42.28,75.3-67.75,95.49-15.89,12.35-31.78,17.38-48.39,12.26-11.72-3.23-23.38-8.23-35.18-2.71-12.65,5.5-24.55,22.1-28.89,46-7.34,39.05,4.49,94.18,28.29,94.27,17.34.23,31.95-22.41,45.32-41.4,9.2-13.32,18.41-26.52,27.99-38.8,8.06-10.37,16.38-19.95,25-28.52,15.65-15.87,33.01-28.02,46.65-48.92,27.42-40.35,29.81-115.68,16.82-172.92-18.11-78.77-44.02-100.45-41.4-199.18-.21-32.59,7.11-113.4-10.54-129.24-10.59-7.62-19.76,6.88-29.83,16.89-5.63,6.08-11.49,11.32-17.39,16.31-40.1,30.19-28.13,82.9-6.31,133.8l.11.25Z" },
            { id: 4, viewBox: "0 0 231.78 656.84", path: "M133.06,533.76c-21.6,42.89,5.94,77.01-5.09,110.55-10.59,25.75-33.77,6.42-44.75-9.79-40.84-55.25,7.39-127.87,36.23-187.91,6.1-15.45,9.58-31.3,11.65-48.34,6.01-45.63-6.33-54.33-17.38-90.97-12.97-44.93,20.67-71.22,22.55-111.59.56-15.95-4.68-32.33-13.24-41.55-27.65-28.87-66.16,31.18-68.25,71.73-1.67,43.22,38.49,70.76,32.1,113.65-2.25,13-9.75,22.89-18.18,26.48-25.1,10.58-52.07-30.63-57.75-66.44-3.39-20,.53-40.61-.42-60.83-.93-25.23-12.09-47.8-10.33-73.28C4.22,115.89,40.97,56.26,69.37,32.64,100.56,6.16,138.87-9.76,173.81,6.67c37.43,18.17,65.71,82.31,56.07,141.54-4.94,31.15-20.54,58.48-23.77,90.04-4.11,44.06,27.02,90.63,7.57,132.51-7.31,16.19-19.84,25.87-30.65,35.48-30.05,25.82-16.89,55.86-29.92,91.65-5.3,13.34-13.79,23.18-19.92,35.62l-.12.25Z" },
            { id: 5, viewBox: "0 0 155.99 501.32", path: "M52.1,141.33c-7.39,17.69,11.13,47.22,6.93,71.8-2.45,24.67-27.03,42.6-20.94,65.47,8.6,25.9,37.72,36.09,52.25,57.27,9.12,11.78,14.67,28.68,20.46,44.93,4.38,12.33,9.6,23.28,15.47,33.8,6.48,12.09,13.82,25.21,14.77,42.03.84,17.98-6.41,32.1-16.95,39.3-21.13,13.29-50.63.95-66.43-25.62-5.62-9.61-9.29-22.21-10-35.65-1.61-30.03,8.04-54.96-10.47-73.5-9-9.83-20.33-16.64-27.22-31.23-7.63-16.31-6.48-39.58-8.53-59.63-1.06-16.38-3.47-28.05,2.07-39.75,5.98-12.72,18.12-21.44,18.39-39.66.2-14.16-7.69-30.01-12.72-42.06C3.66,136.01-1.11,121.39.3,105.22,4.35,67.41,32.45,35.53,52.36,18.06,64.07,8.22,76.7,1.9,89.82.39c12.5-1.45,25.42,1.07,37.09,8.31,28.82,17.62,38.83,66.28,18.06,96.93-9.57,13.49-22.66,19.16-34.99,21.15-15.43,4.05-47.97-5.23-57.81,14.38l-.07.16Z" },
            { id: 6, viewBox: "0 0 115.61 639.26", path: "M92.13,622.91c-11.79,24.58-30.04,18.55-43.28,1-9.19-11.9-17-27.66-23.62-43.7C3.29,525.91-5.52,456.11,3.51,391.46c9.11-68.92,37.33-90.26,50.06-149.17,8.39-37.75,3.1-77.5.46-115.88-1.08-18.22-1.06-36.71.71-54.81C57.67,41.33,67.33-.43,88.07,0c14.88,1.51,24.14,29.64,26.36,52.93,3.82,35.93-2.35,74.83-8.69,109.21-2.31,12.81-4.38,25.78-5.57,39.01-2.07,22.06-1.67,44.23-1.2,66.6.66,25.05-.66,50.36-1.55,75.31-1,27.75-.37,55.46,1.85,82.99,3.66,46.21,9.45,92.86,5.61,139.63-1.39,19.95-5.09,42.11-12.69,57.11l-.05.11Z" },
            { id: 7, viewBox: "0 0 123.44 596.69", path: "M117.61,525.87c9.21,15.17,6.75,35.08-2.05,48.97-12.71,20.05-31,10.17-46.28,12.56-13.31,2.08-34.36,26.67-37.15-13.83-.91-13.22,4.06-27.85,3.33-40.9-1.55-27.66-14.18-35.9-9.44-82.34,7.4-72.4,54.31-102.36,47-199.42-1.06-14.09-7.62-32.65-7.48-44.14.15-12.92,19.1-60.78,2.52-68.19-25.87-11.55-44.68,99.66-62.68,65.98-16.65-31.16,9.95-78.43,18.8-106.54C34.01,66.78,42.34,8.17,66.75,1.21c39.15-11.16,54.61,56.96,42.89,116.93-4.33,22.16-19.34,45.05-19.77,70.19-.4,23.26,16.36,46.16,19.36,64.36,7.53,45.66-19.56,87.32-29.29,126.34-6.22,24.92-12.91,73.1-6.09,98.17,8.25,30.31,33.38,31.57,43.76,48.67Z" },
            { id: 8, viewBox: "0 0 316.2 570.55", path: "M35.31,178.31c14.68-25.61,41.64-23.49,55.15,3.47,16.55,30.11,11.57,80.01,27.77,108.35,13.3,21.27,34.63,1.79,49.71,16.21,16.32,15.4,23,46.96,44.86,28.91,6.46-4.69,13.79-11.03,19.44-17.43,4.64-4.96,7.85-11.71,7.87-20.61.17-13.32-3.05-36.58.67-53.2,3.78-23.8,19.25-46.57,11.65-71.74-10.06-30.27-36.53-53.64-41.22-93.06-3.48-24.07,1.96-51.52,14.66-66.39,17.39-20.54,43.16-14.27,60.91,3.75,10.81,10.89,19.53,27.69,24.22,46.58,17.35,66.1-19.37,114.65-28.95,174.31-3.02,19.52-1.94,39.54,3.06,58.14,11.3,44.47,51.61,102.55,17.96,145.22-8.56,10.35-20.32,14.33-30.8,9.75-19.23-7.08-31.93-42.28-49.89-43.27-12.01.31-23.7,11.92-35.99,8.47-14.07-2.75-23.51-24.87-34.77-34.81-2.54-2.2-5.25-3.77-8.09-4.71-16.47-4.13-31.31,2.55-44.19-21.19-4.23-7.56-7.34-16.41-10.13-25.73-4.29-13.32-11.73-48.75-20.82-51.02-4.92,2.28,7.43,37.86,6.84,48.72,1.12,19.91-8.96,37.63-12.64,56.05-11.13,49.83,32.93,78.89,28.86,130.51-1.08,18.84-8.16,36.88-18.19,47.21-24.14,25.28-56.46-2.28-67.82-39.92-18.26-56.8,14.4-104.54,26.29-155.88,16.56-67.76-25.58-133.77,3.46-186.47l.12-.21Z" },
            { id: 9, viewBox: "0 0 229.96 576.01", path: "M38.4,4.48c14.14,11.45,27.51,34.74,40.76,50.77,21.41,26.66,24.83,57.13,11.82,96.61-7.69,23.41-18.61,43.86-27.69,66.2-4.76,11.8-9.43,24.99-11.03,39.17-2.74,21.9,5.87,35.57,18.17,25.93,46.81-45.33,29.72-186.04,70.75-246.85,18.38-30.77,55.68-52.22,72.27-7.58,12.33,35.54.5,79.47-19.41,97.21-19.68,19.22-45.37,22.49-60.28,54.35-11.61,24.72-13.93,58.14-18.99,88.07-1.92,14.13-7.18,46.73,3.7,44.81,14.94-7.73,24.84-48.26,35.25-68.82,7-15.06,15.76-27.75,26.31-34.07,23.4-15.25,53.29,6.57,49.63,55.65-2.71,35.19-18.43,66.14-17.95,102.62-.85,49.09,26.96,103.55,5.25,148.4-18.43,35.41-47.53,8.72-55.06-32.2-7.23-34.21.18-69.65,9.5-100.75,5.2-19.1,12.82-43.05,9.26-62.71-6.86-25.17-24.83,1.41-33.04,12.34-7.29,10.23-14.79,20.03-22.93,28.07-12.46,12.78-25.54,21.6-32.83,42.11-8.87,24.93-2.93,57.66-1.44,85.66,1.92,29.29-1.44,63.86-16.78,79.96-18.11,19.06-40.29-6.01-43.15-40.89-2.53-23.92,2.26-48.09,4.37-71.59,1.32-14.39,1.44-28.63-.51-42.21-4.84-34.14-20.89-59.79-27.97-92.41-10.25-43.02-3.32-85.95,11.7-122.25,5.66-15,12.84-32.49,12.84-50.08.21-23.77-12.47-39.8-20.61-56.64C4.13,81.01-.4,65.76.03,49.06.54,15.05,19.88-10.59,38.23,4.36l.17.12Z" },
            { id: 10, viewBox: "0 0 396.68 373.56", path: "M335.28,170.5c-57.79-21.65-37.5-46.35-54.42-77.16C255.67,47.46,123.71-12.74,33.63,2.38-3.01,8.52-10.99,37.06,16.94,51.59c55.89,29.07,152.96,4.29,215.72,36.08,52.28,26.48,57.5,84.9-29.54,87.41-24.94.72-102.55-20.02-91.23,16.86,7.62,24.82,70.27,6.3,97.61,7.65,76.59,3.76,73.66,52.9,33.57,79.7-47.31,31.62-109.45,21.71-171.63,28.16-98.31,10.2-96.28,74.59,12.94,65.16,79.17-6.84,179.58-52.39,198.83-95.76,10.72-24.15-1.17-44.02,32.53-64.71,20.68-12.7,50.83-18.95,80.93-18.91v-11.86c-20.33-.02-41.42-3.41-61.4-10.89Z" },
            { id: 11, viewBox: "0 0 225.86 239.5", path: "M220.46,83.81c6.68-9.76,6.97-18.03,1.95-28.72C196.3,5.89,130.25-10.71,79.59,6.72-12.89,38.14-27.21,163.16,49.45,220.28c11.11,8.42,23.69,12.65,37.46,12.49,28.35.56,53.95-28.86,73.17-18.11,10.38,5.62,11.33,18.48,23.25,22.47,9.85,4.12,25.79,3.28,33-5.64,11.13-13.17,2.06-32.65-8.93-43.17-17.98-18.29-45.19-14.38-67.61-22.73-35.22-13.68-64.81-48.23-76.41-84-5.78-18.06-3.58-49.44,19.77-51.67,21.37-1.57,34.16,22.18,37.12,41.37,2.58,14.07,2.37,27.81,5.48,41.43,2.98,14.04,10.72,27.14,22.22,35.92,17.44,13.46,44.75,19.02,60.62,1.71,7.08-8.12,8.26-18.79,7.14-29.63-1.58-14.33-3.9-24.35,4.67-36.77l.07-.11Z" },
            { id: 12, viewBox: "0 0 163.43 325.65", path: "M94.47,32.81c6.34,9.91,11.55,20.67,16.51,31.39,7.73,15.75,9.15,28.49,4.22,45.56-3.22,12.32-8.81,23.95-14.33,35.45-6.08,12.33-8.41,24.3-2.1,37.11,8.72,18.53,26.28,29.69,39.26,44.92,13.92,17.18,27.57,40.54,25.12,62.58-3.28,23.3-22.02,39.97-46.14,34.93-19.94-3.8-35.99-18.5-46.63-34.97-9.07-13.65-17.16-29.02-20.89-45.05-2.58-11.08-2.84-22.71-7.18-33.33-4.39-11.04-11.88-20.75-20.6-28.83-9.21-8.13-18.52-16.18-20.79-28.82-4.18-16.9,6.74-31.19,19.18-41.61,9.41-7.76,19.09-16.08,21.82-28.51,2.35-9.2,3.01-18.82,2.68-28.28.01-17.62-9.05-41.29,9-52.58,7.22-4.4,16.67-3.56,22.71,2.4,4.61,4.12,7.75,10.07,11.09,15.81,2.26,3.93,4.62,7.82,6.99,11.68l.09.14Z" },
            { id: 13, viewBox: "0 0 218 183.93", path: "M72.59,151.87c36.39,36.06,96.49,2.76,83.91-52.16-3.42-14.92-22.14-22.68-28.26-35.27-25.87-53.23,50.46-90.45,79.23-41.85,31.09,52.51-11.77,130.46-62.62,153.63C69.07,210.75-10.74,122.59,1.19,47.5,13.61-30.66,115.9-2.64,90.28,61.83c-6.33,15.93-26.83,21.96-29.95,41.04-2.72,16.63-.05,36.8,12.26,49Z" },
            { id: 14, viewBox: "0 0 292.62 221.31", path: "M289.94,118.97c8.33-8.03-4.69-12.29-13.41-15.96-7.85-2.94-15.14-7.14-21.82-12.21-19.33-14.7-34.56-35.27-51.84-52.7C185.56,19.92,163.7,5.04,138.57,1.39,85.32-6.81,14.01,21.56,1.11,78.34c-2.86,13.55-.73,28.17,12.44,33.9,11.85,5.4,28.67,1.56,34.83-10.69,3.77-6.88,5.09-15.39,6.96-23.16,6.13-35.46,37.7-57.2,72.9-59.39,10.56-.66,21.28.76,31.21,4.41,10.06,3.63,18.91,9.48,27.32,15.72,3.12,2.57,18.54,13.52,9.75,16.26-3.29,1.04-9.87.84-16.76.72-64.86-1.85-108.44,67.71-75.74,124.23,15.46,26.7,46.02,41.48,76.5,40.95,26.22-.22,50.48-12.29,70.63-28.48,18.63-15.7,5.63-29.18,12.3-47.89,4.41-13.37,16.72-17.36,26.39-25.86l.11-.10Z" },
            { id: 15, viewBox: "0 0 268.66 281.47", path: "M138.83,134.21c13.28,16.47,66.26,10.68,90.22,19.94,69.4,26.83,39.1,152.89-25.52,122.67-35-16.37-6.48-100.35-66.48-121.04-69.35-23.91-71.66,67.57-101.31,107.34-7.99,5.64-13.6,2.31-20.34-2.74-57.46-43.03,63.55-147.4,74.41-186.74,5.08-18.37-13.36-46.09,1.74-65.55L106.44,0c85.14,11.31,3.88,98.83,32.4,134.21Z" },
            { id: 16, viewBox: "0 0 351.43 239.81", path: "M194.39,15.64c-15.21,12.88-17.48,34.19-27.92,50.25-7.59,11.97-19.55,20.5-27.47,32.85-5.88,8.82-8.91,19.52-13.39,28.94-11.5,25.38-36.73,13.36-55.87,35.3-7.52,7.59-11.64,16.52-20.43,20.3-7.05,2.12-6.95-7.94-5.37-13.23,1.65-6.73,4.8-13.45,8.23-19.54,6.09-10.51,12.48-20.01,23.03-27.47,17.65-12.16,43.64-20.89,54.5-41.75,11.24-20.53,7.87-52.58-15.52-61.78-17.3-6.94-43,2.08-51.81,20.07-6.87,12.71-.7,27.12,1.75,40,1.37,7.71-.61,13.83-5.04,20.07-5.39,7.66-12.09,14.97-16.49,23.38-7.32,13.83-9.69,29.78-18.8,42.65C15,179.17,1.43,192.63.11,209.76c-1.78,21.08,19.16,34.42,38.65,28.74,20.14-4.97,34.42-25.76,50.06-36.66,11.13-8.2,25-9.82,38.45-10.32,3.76-.23,7.52-.53,11.14-1.16,13.8-2.32,24.18-8.42,37.36-5.61,13.31,2.78,25.81,12.27,39.99,9.27,15.02-2.7,28.97-14.08,44.11-18.39,14.73-4.92,30.99-2.96,45.92-6.41,10.91-2.38,20.77-10.47,17.69-22.13-2.79-12.15-15.65-21.86-22.05-32.13-4.15-6.25-3.24-12.9,3.06-16.98,8.35-5.98,25.73-9.78,36.01-18.34,12.62-9.61,14.38-25.3,4.93-38.3-7.25-10.3-18.61-18.47-29.74-24.69C291.83,2.96,264.87-2.06,237.74.76c-15.15,1.3-31.55,4.58-43.2,14.75l-.15.13Z" },
            { id: 17, viewBox: "0 0 290.43 194.6", path: "M279.64,69.11c-.7-16.06,13.69-20.56-2.3-42.06-15.22-20.47-44.28-23.5-68.08-21.06-21.8,2.24-48.92,23.33-58.14,46.89-3.36,8.58-7.16,6.44-7.16,6.44-2.72-1.29,0-8.91,0-8.91,4.94-14.77.86-30.96-13.62-41.08C102.12-10.38,59.1,4.01,35.76,25.74,9.18,50.47-9.98,95.19,5.6,130.37c4.39,9.92,20.42,28.48,30.82,31.12,25.81,6.56,39.73-12.73,55.78-11.28,15.42,1.4,41.69,31.03,60.73,38.48,22.33,8.74,42.83,9.02,61.62-7.65,8.48-7.52,15.21-24.29,23.27-30,17-12.05,39.62-8.2,50.06-34.18,8.69-21.64-7.54-32.01-8.23-47.74Z" },
            { id: 18, viewBox: "0 0 389.86 237.26", path: "M37.01,128.85c1.88-3.81,6.19-6.89,11.85-9.88,4.97-2.64,11.2-5.68,17.51-8.89,11.12-5.8,22.17-11.18,30.56-20.11,18.63-20.22,21.04-60.57.38-80.36-14.09-12.12-36.74-12.14-52.86-3.64C26.63,16.01,9.13,31.94,18.32,54.18c5,14.56,27.27,26.58,10.62,41.41-7.37,7.05-18.8,11.47-24.96,20.09-11.03,17.48,2.98,42.68,16.33,57.8,8.25,9.32,18.48,13.29,30.26,17.11,6.85,2.31,14.39,4.75,21.44,6.94,25.42,7.91,44.22,14.54,68.13.61,14.6-6.85,23.7,1.59,36.86,6.18,13.04,4.28,28.89,1.96,38.12-8.84,8.87-9.72,14.49-22.62,23.94-31.76,12.25-13.24,35.77-16.63,42.43-32.54,2.47-6.35,2.19-13.33,3.44-20.07,1.38-9.14,7.02-17.71,15.33-22.15,43.32-20.48,50.39,55.45,19.24,75.07-14.99,10.59-28.21,5.87-44.35,7.41-13.59,1.96-16.79,16.47-14.39,28.91,7.9,39.51,55.65,51.7,75.45,14.64,8.95-14.45,10.18-32.01,16.72-47.04,3.65-8.44,9.38-15.85,15.15-23.19,7.59-9.52,14.86-19.58,18.32-31.4,6.97-23.84,4.17-52.95-15.35-68.6-11.65-9.56-29.34-11.57-44.24-8.81-9.05,1.22-18.69,4.25-27.64,2.55-10.54-2.08-18.48-11.49-28.17-15.57-5.39-2.39-11.25-3.27-17.12-4.01-19.23-1.67-40.32-5.9-59.4-2.73-32.62,7.25-32.41,25.54-48.98,48.21-7.38,9.85-17.83,14.74-27.64,22.48-13.36,10.42-17,24.81-17.27,41.01-.48,7.67-1.52,16.13-8.76,19.77-13.78,6.6-63.39,1.54-54.87-18.71l.06-.11Z" },
            { id: 19, viewBox: "0 0 285.06 261.74", path: "M269.48,1.07c-24.16-7.14-26.93,23.78-26.93,23.78-9.57,59.48-55.04,120.7-118.08,127.56-39.84,4.34-86.45-25.13-115.11,19.01-29.81,45.9,16.89,94.3,65.09,90.06,64.1-5.63,119.77-80.36,150.56-131.73,9.33-15.58,21.87-46.24,52.42-89.16,20.96-29.99-7.95-39.51-7.95-39.51Z" },
            { id: 20, viewBox: "0 0 121.1 287.9", path: "M111.62,276.16c28.74-32.49-31.21-66.81-23.07-102.83,1.83-10.57,7.1-20.08,12.3-29.32,4.82-8.48,9.37-17.37,13.45-26.9,9.3-20.72,1.4-24.52.33-43.94.09-14.96,8.2-26.78,6.13-41.9C120.02,17.35,110.34-.55,95.06.01c-6.48.25-12,4.61-18,6.45-5.61,1.98-11.65,1.77-16.91,4.63-8.09,4.57-13.67,17.03-14.96,26.8-1.36,10.69,1.75,21.7,2.65,32.19,1.72,12.65-1.98,28.18-14.28,34.67-6.76,4.14-14.66,4.71-21.31,8.78C2.88,119.53-.22,132.33.01,143.61c.38,13.57,6.54,25.28,15.98,34.99,4.09,4.17,9.08,7.9,12.9,12.17,8.9,8.55,6.39,17.7,1.97,27.71-12.19,26.05,9.99,54,33.14,64.83,15.25,8.33,34.76,4.88,47.38-6.92l.23-.24Z" },
            { id: 21, viewBox: "0 0 100 100", path: "M50,5 A45,45 0 1,1 50,95 A45,45 0 1,1 50,5 Z" },
            { id: 22, viewBox: "0 0 100 100", path: "M10,10 L90,10 L90,90 L10,90 Z" },
            { id: 23, viewBox: "0 0 100 100", path: "M50,10 L90,90 L10,90 Z" },
            { id: 24, viewBox: "0 0 100 120", path: "M20,20 L80,20 L80,100 L20,100 Z M25,15 L75,15 L75,20 L25,20 Z M25,100 L75,100 L75,105 L25,105 Z" }
        ];
        
        // Three.js setup
        const canvas = document.getElementById('canvas-3d');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
        
        renderer.setSize(600, 600);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setClearColor(0x1a1a1a);
        camera.position.z = 200;
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(10, 10, 5);
        scene.add(directionalLight);
        
        const rimLight = new THREE.DirectionalLight(0x00ff88, 0.3);
        rimLight.position.set(-10, 0, -10);
        scene.add(rimLight);
        
        // State
        const addedMeshes = [];
        const colorPalette = [
            { base: 0xf093fb, rim: 0xf5576c },
            { base: 0x4facfe, rim: 0x00f2fe },
            { base: 0x43e97b, rim: 0x38f9d7 },
            { base: 0xfa709a, rim: 0xfee140 },
            { base: 0xff6b9d, rim: 0xc44569 },
            { base: 0x8e2de2, rim: 0x4a00e0 },
            { base: 0xffd89b, rim: 0x19547b },
            { base: 0x667eea, rim: 0x764ba2 }
        ];
        let selectedColorIndex = 0;
        
        // Raycaster for object selection
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedMesh = null;
        let isDraggingObject = false;
        let dragPlane = new THREE.Plane();
        let intersection = new THREE.Vector3();
        let offset = new THREE.Vector3();
        
        // SVG to Shape - Complete rewrite
        function svgPathToShape(pathData) {
            const shape = new THREE.Shape();
            
            // Clean and parse the path
            let currentX = 0, currentY = 0;
            let startX = 0, startY = 0;
            
            // Split into commands
            const tokens = pathData.match(/[a-df-z][^a-df-z]*/gi);
            
            if (!tokens) return shape;
            
            tokens.forEach(token => {
                const cmd = token[0];
                const values = token.slice(1)
                    .trim()
                    .split(/[\s,]+/)
                    .filter(v => v)
                    .map(v => parseFloat(v));
                
                // Skip if invalid values
                if (values.some(v => isNaN(v))) return;
                
                switch (cmd) {
                    case 'M': // absolute moveTo
                        if (values.length >= 2) {
                            currentX = startX = values[0];
                            currentY = startY = values[1];
                            shape.moveTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'm': // relative moveTo
                        if (values.length >= 2) {
                            currentX += values[0];
                            currentY += values[1];
                            startX = currentX;
                            startY = currentY;
                            shape.moveTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'L': // absolute lineTo
                        if (values.length >= 2) {
                            currentX = values[0];
                            currentY = values[1];
                            shape.lineTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'l': // relative lineTo
                        if (values.length >= 2) {
                            currentX += values[0];
                            currentY += values[1];
                            shape.lineTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'H': // absolute horizontal
                        if (values.length >= 1) {
                            currentX = values[0];
                            shape.lineTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'h': // relative horizontal
                        if (values.length >= 1) {
                            currentX += values[0];
                            shape.lineTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'V': // absolute vertical
                        if (values.length >= 1) {
                            currentY = values[0];
                            shape.lineTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'v': // relative vertical
                        if (values.length >= 1) {
                            currentY += values[0];
                            shape.lineTo(currentX, -currentY);
                        }
                        break;
                        
                    case 'C': // absolute cubic bezier
                        for (let i = 0; i + 5 < values.length; i += 6) {
                            shape.bezierCurveTo(
                                values[i], -values[i + 1],
                                values[i + 2], -values[i + 3],
                                values[i + 4], -values[i + 5]
                            );
                            currentX = values[i + 4];
                            currentY = values[i + 5];
                        }
                        break;
                        
                    case 'c': // relative cubic bezier
                        for (let i = 0; i + 5 < values.length; i += 6) {
                            shape.bezierCurveTo(
                                currentX + values[i], -(currentY + values[i + 1]),
                                currentX + values[i + 2], -(currentY + values[i + 3]),
                                currentX + values[i + 4], -(currentY + values[i + 5])
                            );
                            currentX += values[i + 4];
                            currentY += values[i + 5];
                        }
                        break;
                        
                    case 'Z':
                    case 'z':
                        shape.lineTo(startX, -startY);
                        break;
                }
            });
            
            return shape;
        }
        
        // Add part to 3D
        function addPartTo3D(svg) {
            try {
                // Create a plane with SVG as texture using Data URL
                const canvas = document.createElement('canvas');
                canvas.width = 512;
                canvas.height = 512;
                const ctx = canvas.getContext('2d');
                
                // Create SVG string
                const svgString = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="${svg.viewBox}" width="512" height="512"><path d="${svg.path}" fill="white"/></svg>`;
                
                const img = new Image();
                
                img.onload = function() {
                    ctx.clearRect(0, 0, 512, 512);
                    ctx.drawImage(img, 0, 0, 512, 512);
                    
                    const texture = new THREE.CanvasTexture(canvas);
                    texture.needsUpdate = true;
                    
                    // Get currently selected color
                    const colors = colorPalette[selectedColorIndex];
                    console.log('Adding part with color:', selectedColorIndex, colors);
                    
                    // Create group for multiple layers to give thickness
                    const group = new THREE.Group();
                    
                    // Create many thin layers (0.5 spacing) for solid appearance
                    const thickness = 15;
                    const layers = 30;
                    
                    for (let i = 0; i < layers; i++) {
                        const z = -thickness/2 + (i / (layers - 1)) * thickness;
                        
                        const geometry = new THREE.PlaneGeometry(50, 50);
                        
                        // Apply selected color to each layer
                        const material = new THREE.MeshPhongMaterial({
                            map: texture,
                            color: colors.base,
                            emissive: colors.rim,
                            emissiveIntensity: 0.2,
                            transparent: true,
                            opacity: 1,
                            side: THREE.DoubleSide,
                            alphaTest: 0.1,
                            depthWrite: true
                        });
                        
                        const mesh = new THREE.Mesh(geometry, material);
                        mesh.position.z = z;
                        group.add(mesh);
                    }
                    
                    // Auto-combine positioning - parts cluster together at center
                    const count = addedMeshes.length;
                    
                    // Random position near center with slight spread
                    const spreadRadius = 25; // How far from center parts can be
                    const randomAngle = Math.random() * Math.PI * 2;
                    const randomDistance = Math.random() * spreadRadius;
                    
                    group.position.x = Math.cos(randomAngle) * randomDistance;
                    group.position.y = Math.sin(randomAngle) * randomDistance;
                    group.position.z = (Math.random() - 0.5) * 30; // Random depth
                    
                    // Random rotation for variety
                    group.rotation.x = Math.random() * Math.PI * 2;
                    group.rotation.y = Math.random() * Math.PI * 2;
                    group.rotation.z = Math.random() * Math.PI * 2;
                    
                    group.userData.svgId = svg.id;
                    
                    // Add random animation type for each part
                    group.userData.animationType = Math.floor(Math.random() * 4);
                    group.userData.animationSpeed = 0.5 + Math.random() * 1.5;
                    group.userData.animationOffset = Math.random() * Math.PI * 2;
                    
                    scene.add(group);
                    addedMeshes.push(group);
                    
                    document.getElementById('part-count').textContent = addedMeshes.length;
                };
                
                img.onerror = function(e) {
                    console.error('Failed to load SVG image for', svg.id, e);
                };
                
                // Use data URL instead of blob
                img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgString);
                
            } catch (error) {
                console.error('Error adding part:', svg.id, error.message);
            }
        }
        
        // Remove last part
        function removeLastPart() {
            if (addedMeshes.length > 0) {
                const mesh = addedMeshes.pop();
                scene.remove(mesh);
                if (mesh.geometry) mesh.geometry.dispose();
                if (mesh.material) mesh.material.dispose();
                document.getElementById('part-count').textContent = addedMeshes.length;
            }
        }
        
        // Mouse interaction
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let targetRotation = { x: 0.3, y: 0 };
        let currentRotation = { x: 0.3, y: 0 };
        
        // Get mouse position in normalized device coordinates
        function getMousePosition(event) {
            const rect = canvas.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
        }
        
        // Check for mesh intersection
        function checkIntersection(event) {
            getMousePosition(event);
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(addedMeshes, true);
            
            if (intersects.length > 0) {
                // Find the parent group
                let object = intersects[0].object;
                while (object.parent && !addedMeshes.includes(object)) {
                    object = object.parent;
                }
                return object;
            }
            return null;
        }
        
        // Deselect mesh
        function deselectMesh() {
            if (selectedMesh) {
                // Remove selection indicator (outline or glow)
                selectedMesh.userData.selected = false;
                selectedMesh = null;
                document.getElementById('selected-info').classList.remove('active');
                
                // Reset sliders
                document.getElementById('scale-slider').value = 100;
                document.getElementById('scale-value').textContent = '100%';
                document.getElementById('rotation-x-slider').value = 0;
                document.getElementById('rotation-x-value').textContent = '0°';
                document.getElementById('rotation-y-slider').value = 0;
                document.getElementById('rotation-y-value').textContent = '0°';
                document.getElementById('rotation-z-slider').value = 0;
                document.getElementById('rotation-z-value').textContent = '0°';
            }
        }
        
        // Select mesh
        function selectMesh(mesh) {
            deselectMesh();
            selectedMesh = mesh;
            selectedMesh.userData.selected = true;
            document.getElementById('selected-info').classList.add('active');
            
            // Update scale slider to match current scale
            const currentScale = Math.round(mesh.scale.x * 100);
            document.getElementById('scale-slider').value = currentScale;
            document.getElementById('scale-value').textContent = currentScale + '%';
            
            // Update rotation sliders
            if (mesh.userData.manualRotation) {
                const rotX = Math.round((mesh.userData.manualRotation.x * 180) / Math.PI);
                const rotY = Math.round((mesh.userData.manualRotation.y * 180) / Math.PI);
                const rotZ = Math.round((mesh.userData.manualRotation.z * 180) / Math.PI);
                
                document.getElementById('rotation-x-slider').value = rotX;
                document.getElementById('rotation-x-value').textContent = rotX + '°';
                document.getElementById('rotation-y-slider').value = rotY;
                document.getElementById('rotation-y-value').textContent = rotY + '°';
                document.getElementById('rotation-z-slider').value = rotZ;
                document.getElementById('rotation-z-value').textContent = rotZ + '°';
            }
        }
        
        canvas.addEventListener('mousedown', (e) => {
            const intersectedMesh = checkIntersection(e);
            
            if (intersectedMesh && addedMeshes.includes(intersectedMesh)) {
                // Select and prepare to drag
                selectMesh(intersectedMesh);
                isDraggingObject = true;
                
                // Set up drag plane
                dragPlane.setFromNormalAndCoplanarPoint(
                    camera.getWorldDirection(dragPlane.normal),
                    selectedMesh.position
                );
                
                // Calculate offset
                raycaster.setFromCamera(mouse, camera);
                raycaster.ray.intersectPlane(dragPlane, intersection);
                offset.copy(intersection).sub(selectedMesh.position);
            } else {
                // Start camera rotation
                isDragging = true;
                deselectMesh();
            }
            
            previousMousePosition = { x: e.offsetX, y: e.offsetY };
        });
        
        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            isDraggingObject = false;
        });
        
        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
            isDraggingObject = false;
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (isDraggingObject && selectedMesh) {
                // Move selected object
                getMousePosition(e);
                raycaster.setFromCamera(mouse, camera);
                raycaster.ray.intersectPlane(dragPlane, intersection);
                selectedMesh.position.copy(intersection.sub(offset));
                
                // Store original position for animation
                if (!selectedMesh.userData.originalPosition) {
                    selectedMesh.userData.originalPosition = selectedMesh.position.clone();
                }
                selectedMesh.userData.originalPosition.copy(selectedMesh.position);
                
            } else if (isDragging) {
                // Rotate camera
                const deltaMove = {
                    x: e.offsetX - previousMousePosition.x,
                    y: e.offsetY - previousMousePosition.y
                };
                
                targetRotation.y += deltaMove.x * 0.01;
                targetRotation.x += deltaMove.y * 0.01;
            }
            
            previousMousePosition = { x: e.offsetX, y: e.offsetY };
        });
        
        // Scale slider for selected object
        const scaleSlider = document.getElementById('scale-slider');
        const scaleValue = document.getElementById('scale-value');
        
        scaleSlider.addEventListener('input', (e) => {
            if (selectedMesh) {
                const scale = e.target.value / 100;
                selectedMesh.scale.setScalar(scale);
                scaleValue.textContent = e.target.value + '%';
            }
        });
        
        // Rotation sliders for selected object
        const rotationXSlider = document.getElementById('rotation-x-slider');
        const rotationYSlider = document.getElementById('rotation-y-slider');
        const rotationZSlider = document.getElementById('rotation-z-slider');
        const rotationXValue = document.getElementById('rotation-x-value');
        const rotationYValue = document.getElementById('rotation-y-value');
        const rotationZValue = document.getElementById('rotation-z-value');
        
        rotationXSlider.addEventListener('input', (e) => {
            if (selectedMesh) {
                const degrees = e.target.value;
                selectedMesh.userData.manualRotation = selectedMesh.userData.manualRotation || { x: 0, y: 0, z: 0 };
                selectedMesh.userData.manualRotation.x = (degrees * Math.PI) / 180;
                rotationXValue.textContent = degrees + '°';
            }
        });
        
        rotationYSlider.addEventListener('input', (e) => {
            if (selectedMesh) {
                const degrees = e.target.value;
                selectedMesh.userData.manualRotation = selectedMesh.userData.manualRotation || { x: 0, y: 0, z: 0 };
                selectedMesh.userData.manualRotation.y = (degrees * Math.PI) / 180;
                rotationYValue.textContent = degrees + '°';
            }
        });
        
        rotationZSlider.addEventListener('input', (e) => {
            if (selectedMesh) {
                const degrees = e.target.value;
                selectedMesh.userData.manualRotation = selectedMesh.userData.manualRotation || { x: 0, y: 0, z: 0 };
                selectedMesh.userData.manualRotation.z = (degrees * Math.PI) / 180;
                rotationZValue.textContent = degrees + '°';
            }
        });
        
        // Delete button
        document.getElementById('delete-btn').addEventListener('click', () => {
            if (selectedMesh) {
                const index = addedMeshes.indexOf(selectedMesh);
                if (index > -1) {
                    scene.remove(selectedMesh);
                    addedMeshes.splice(index, 1);
                    
                    // Clean up
                    selectedMesh.traverse((child) => {
                        if (child.geometry) child.geometry.dispose();
                        if (child.material) child.material.dispose();
                    });
                    
                    deselectMesh();
                    document.getElementById('part-count').textContent = addedMeshes.length;
                }
            }
        });
        
        // Delete key to remove selected object
        document.addEventListener('keydown', (e) => {
            if ((e.key === 'Delete' || e.key === 'Backspace') && selectedMesh) {
                e.preventDefault(); // Prevent browser back navigation on Backspace
                const index = addedMeshes.indexOf(selectedMesh);
                if (index > -1) {
                    scene.remove(selectedMesh);
                    addedMeshes.splice(index, 1);
                    
                    // Clean up
                    selectedMesh.traverse((child) => {
                        if (child.geometry) child.geometry.dispose();
                        if (child.material) child.material.dispose();
                    });
                    
                    deselectMesh();
                    document.getElementById('part-count').textContent = addedMeshes.length;
                }
            }
        });
        
        // Animation
        function animate() {
            requestAnimationFrame(animate);
            
            currentRotation.x += (targetRotation.x - currentRotation.x) * 0.1;
            currentRotation.y += (targetRotation.y - currentRotation.y) * 0.1;
            
            const time = Date.now() * 0.001;
            
            addedMeshes.forEach((mesh, i) => {
                const type = mesh.userData.animationType;
                const speed = mesh.userData.animationSpeed;
                const offset = mesh.userData.animationOffset;
                
                // Base rotation from user interaction
                const baseRotX = currentRotation.x;
                const baseRotY = currentRotation.y;
                
                // Store or get original position
                if (!mesh.userData.originalPosition) {
                    mesh.userData.originalPosition = mesh.position.clone();
                }
                
                const origPos = mesh.userData.originalPosition;
                
                // Add selection glow effect
                if (mesh.userData.selected) {
                    mesh.traverse((child) => {
                        if (child.material) {
                            child.material.emissiveIntensity = 0.5 + Math.sin(time * 3) * 0.2;
                        }
                    });
                } else {
                    mesh.traverse((child) => {
                        if (child.material) {
                            child.material.emissiveIntensity = 0.2;
                        }
                    });
                }
                
                // Don't animate if being dragged
                if (isDraggingObject && mesh === selectedMesh) {
                    return;
                }
                
                // Apply manual rotation if set
                const manualRot = mesh.userData.manualRotation || { x: 0, y: 0, z: 0 };
                
                // Unified animation - all parts float together
                mesh.position.y = origPos.y + Math.sin(time * 0.5) * 8;
                mesh.rotation.x = baseRotX + manualRot.x;
                mesh.rotation.y = baseRotY + manualRot.y;
                mesh.rotation.z = manualRot.z;
            });
            
            renderer.render(scene, camera);
        }
        
        animate();
        
        // Render parts UI
        function renderParts() {
            const leftGrid = document.getElementById('parts-left');
            const rightGrid = document.getElementById('parts-right');
            
            allSvgPaths.forEach((svg, index) => {
                const partItem = document.createElement('div');
                partItem.className = 'part-item';
                partItem.dataset.partId = svg.id;
                partItem.innerHTML = `
                    <svg viewBox="${svg.viewBox}" xmlns="http://www.w3.org/2000/svg">
                        <path d="${svg.path}"/>
                    </svg>
                `;
                
                partItem.addEventListener('click', () => {
                    partItem.classList.add('selected');
                    setTimeout(() => partItem.classList.remove('selected'), 300);
                    addPartTo3D(svg);
                });
                
                // 기본 도형 (id 21-24)은 왼쪽, 커스텀 파츠는 오른쪽
                if (svg.id >= 21 && svg.id <= 24) {
                    leftGrid.appendChild(partItem);
                } else {
                    rightGrid.appendChild(partItem);
                }
            });
        }
        
        // Controls
        document.getElementById('reset-btn').addEventListener('click', () => {
            while (addedMeshes.length > 0) {
                removeLastPart();
            }
        });
        
        document.getElementById('save-btn').addEventListener('click', () => {
            if (addedMeshes.length === 0) {
                alert('Please select at least 1 part!');
                return;
            }
            alert(`Time Capsule Created!\nParts: ${addedMeshes.length}`);
        });
        
        // Color picker
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedColorIndex = parseInt(btn.dataset.color);
                console.log('Selected color index:', selectedColorIndex, colorPalette[selectedColorIndex]);
            });
        });
        
        renderParts();
    </script>
</body>
</html>
